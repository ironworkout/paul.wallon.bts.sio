<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ligue des Champions des Peluches - Road to Glory!</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script async defer src="https://accounts.google.com/gsi/client"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Oswald:wght@400;500;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Palette UCL inspir√©e de l'image */
            --ucl-deep-purple: #100822; /* Violet tr√®s fonc√©, presque noir */
            --ucl-mid-purple: #231249;  /* Violet moyen pour d√©grad√©s */
            --ucl-light-accent: #8A2BE2; /* Violet/Bleu plus clair pour accents si besoin */
            --ucl-connector-blue: #60A5FA; /* Bleu clair pour les lignes/connecteurs */
            --ucl-connector-blue-transparent: rgba(96, 165, 250, 0.7);
            --ucl-team-bg: rgba(230, 230, 240, 0.9); /* Fond des √©quipes (blanc cass√©/gris clair) */
            --ucl-team-bg-winner: rgba(96, 165, 250, 0.8); /* Fond √©quipe gagnante (bleu clair) */
            --ucl-text-primary: #FFFFFF; /* Texte principal (noms d'√©quipes, titres) */
            --ucl-text-secondary: #B0B0D0; /* Texte secondaire (labels de match) */
            --ucl-input-bg: rgba(0, 0, 0, 0.3);
            --ucl-border-color: rgba(96, 165, 250, 0.3); /* Bordure discr√®te */

            /* Conserver les n√©ons pour messages, etc. */
            --neon-green: #39FF14; 
            --neon-red: #FF3131; 
            --neon-yellow: #FFF01F;

            /* Mappage aux variables "current" pour la page LDC */
            --current-bg-color: var(--ucl-deep-purple);
            --current-primary-color: var(--ucl-mid-purple);
            --current-secondary-color: var(--ucl-light-accent);
            --current-accent-gold: #FFD700; /* L'or reste pour le troph√©e/titres */
            --current-text-light: var(--ucl-text-primary);
            --current-card-bg: rgba(35, 18, 73, 0.5); /* Fond de carte translucide violet */
            --current-border-color: var(--ucl-border-color);
            --current-line-color: var(--ucl-connector-blue);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Open Sans', sans-serif; line-height: 1.6; color: var(--current-text-light);
            /* D√©grad√© inspir√© de l'image */
            background-color: var(--ucl-deep-purple);
            background-image: radial-gradient(circle at top right, var(--ucl-mid-purple) 0%, transparent 50%),
                              radial-gradient(circle at bottom left, var(--ucl-mid-purple) 0%, transparent 40%),
                              linear-gradient(135deg, var(--ucl-deep-purple) 0%, var(--ucl-mid-purple) 60%, var(--ucl-deep-purple) 100%);
            overflow-x: hidden; scroll-behavior: smooth;
            min-height: 100vh;
        }
        .container { width: 100%; max-width: 1600px; /* Plus large pour le bracket */ margin: 0 auto; padding: 0 20px; }

        h1, h2, h3, h4, .section-title {
            font-family: 'Oswald', sans-serif; font-weight: 500; /* Police plus fine pour titres */
            color: var(--current-text-light); /* Titres majoritairement blancs */
            text-transform: uppercase; letter-spacing: 1.5px;
            text-shadow: 0 0 10px rgba(96, 165, 250, 0.3); /* Ombre port√©e bleue discr√®te */
        }
        .page-title-bar h1 { color: var(--current-accent-gold); text-shadow: 0 0 12px rgba(255,215,0,0.7); }
        
        header {
            background-color: rgba(16, 8, 34, 0.7); /* Fond header accord√© */
            backdrop-filter: blur(10px);
            padding: 10px 0; position: sticky; top: 0; z-index: 1000;
            border-bottom: 1px solid var(--ucl-border-color);
        }
        .logo img { filter: drop-shadow(0 0 8px var(--current-accent-gold));} 
        .logo h1 { color: var(--current-accent-gold); }
        
        #drive-status { border: 1px solid var(--ucl-connector-blue); }
        #drive-status i { color: var(--ucl-connector-blue); }
        #signin-button { background-color: var(--ucl-connector-blue); color: var(--ucl-deep-purple); }
        #signin-button:hover:not(:disabled) { background-color: var(--ucl-text-primary); }

        nav ul li a:hover, nav ul li a.active-nav-link {
            color: var(--ucl-connector-blue); 
            background-color: rgba(96, 165, 250, 0.1); 
            border-color: var(--ucl-connector-blue);
            box-shadow: 0 0 10px rgba(96, 165, 250, 0.4); 
        }

        .page-title-bar {
            background: transparent; /* Titre sur le fond g√©n√©ral */
            padding: 40px 0; margin-bottom: 30px;
            border-bottom: 2px solid var(--ucl-connector-blue-transparent);
        }
        .page-title-bar h1 { font-size: 3rem; }

        .section { 
            margin-bottom: 40px; background-color: var(--current-card-bg); 
            border-radius: 10px; padding: 25px; 
            box-shadow: 0 8px 30px rgba(0,0,0,0.5); 
            border: 1px solid var(--current-border-color);
        }
        .section-header { border-bottom: 1px solid var(--current-border-color); }
        .section-title { font-size: 2rem; color: var(--current-text-light); }
        
        .league-music-btn {
            background-color: var(--ucl-connector-blue); color: var(--ucl-deep-purple); 
        }
        .league-music-btn:hover { background-color: var(--ucl-mid-purple); color: var(--ucl-connector-blue); border-color: var(--ucl-connector-blue);}

        .season-selector-container select {
            background-color: rgba(16, 8, 34, 0.7); color:var(--current-text-light);
            border: 1px solid var(--ucl-border-color);
        }
        .season-selector-container select option { background-color: var(--ucl-deep-purple); }

        .nouvelle-saison-btn, .sauvegarde-json-btn {
            background-color: var(--ucl-connector-blue); color: var(--ucl-deep-purple);
        }
        .nouvelle-saison-btn:hover:not(:disabled) { background-color: var(--ucl-light-accent); color: var(--ucl-text-primary); }
        .sauvegarde-json-btn { background-color: var(--current-accent-gold); color: var(--ucl-deep-purple); }
        .sauvegarde-json-btn:hover:not(:disabled) { background-color: #fff; color:var(--current-accent-gold); border: 1px solid var(--current-accent-gold); }


        /* NOUVEAUX STYLES POUR LE BRACKET VISUEL LDC */
        #ldc-fixtures-section { background-color: transparent; border: none; box-shadow: none; padding: 0;}
        .knockout-bracket-visual {
            display: flex;
            justify-content: space-between;
            align-items: stretch; /* Les colonnes s'√©tirent */
            padding: 20px 10px;
            min-height: 600px; /* Hauteur minimale pour le bracket */
            width: 100%;
            overflow-x: auto; /* Permet le d√©filement horizontal si besoin */
        }

        .bracket-column {
            display: flex;
            flex-direction: column;
            justify-content: space-around; /* Espace les matchs uniform√©ment */
            align-items: center;
            flex-grow: 1; /* Permet aux colonnes de prendre de l'espace */
            padding: 0 10px; /* Espace entre les colonnes */
            gap: 10px; /* Espace entre les matchs dans une colonne */
            position: relative; /* Pour les connecteurs */
        }
        .bracket-column.rounds-8-4 { /* Colonnes des 8e et Quarts */
            min-width: 200px; /* Largeur minimale pour les noms d'√©quipes */
        }
         .bracket-column.round-semi { min-width: 200px; }

        .bracket-match-item {
            display: flex;
            flex-direction: column; /* Slots d'√©quipe l'un au-dessus de l'autre */
            align-items: center;
            width: 100%; /* Prend toute la largeur de la colonne allou√©e */
            position: relative; /* Pour les labels de match */
            margin: 10px 0; /* Espace vertical entre les "groupes" de match (haut/bas) */
        }

        .team-slot {
            background-color: var(--ucl-team-bg);
            color: var(--ucl-deep-purple); /* Texte fonc√© sur fond clair */
            padding: 8px 12px;
            margin: 2px 0; /* Petit espace entre les deux √©quipes d'un match */
            border-radius: 4px;
            width: 100%;
            display: flex;
            align-items: center;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            position: relative; /* Pour input score */
        }
        .team-slot img.team-logo {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            object-fit: contain;
        }
        .team-slot .team-name {
            flex-grow: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .team-slot input[type="number"].score-input-bracket {
            width: 30px;
            padding: 2px;
            text-align: center;
            font-size: 0.8rem;
            margin-left: 5px;
            border: 1px solid var(--ucl-border-color);
            background-color: rgba(255,255,255,0.7);
            color: var(--ucl-deep-purple);
            border-radius: 3px;
            -moz-appearance: textfield;
        }
        .team-slot input[type="number"].score-input-bracket::-webkit-outer-spin-button,
        .team-slot input[type="number"].score-input-bracket::-webkit-inner-spin-button {
            -webkit-appearance: none; margin: 0;
        }
        /* Style pour √©quipe gagnante (√† appliquer via JS) */
        .team-slot.winner { background-color: var(--ucl-team-bg-winner); color: var(--ucl-text-primary); }
        .team-slot.loser { opacity: 0.7; }


        /* Connecteurs */
        .match-connectors {
            position: absolute;
            top: 50%;
            left: 100%; /* Part de la fin du match */
            height: 100%;
            width: 30px; /* Largeur de la zone de connexion */
            display: flex;
            align-items: center;
        }
        .match-connectors.left-side {
            left: auto;
            right: 100%;
        }

        .connector {
            background-color: var(--ucl-connector-blue);
            position: absolute;
            z-index: -1; /* Derri√®re les matchs */
        }
        .connector.horizontal { height: 2px; }
        .connector.vertical { width: 2px; }
        
        .match-label {
            position: absolute;
            background-color: var(--ucl-mid-purple);
            color: var(--ucl-text-secondary);
            font-size: 0.7rem;
            padding: 1px 4px;
            border-radius: 3px;
            border: 1px solid var(--ucl-connector-blue-transparent);
            z-index: 1;
        }

        .bracket-centerpiece-visual {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0 20px; /* Espace autour du troph√©e */
            min-width: 100px; /* Espace pour le troph√©e */
            position: relative;
        }
        .bracket-centerpiece-visual .trophy-icon {
            font-size: 5rem; /* Ajuster la taille du troph√©e */
            color: var(--current-accent-gold);
            filter: drop-shadow(0 0 15px var(--current-accent-gold));
            margin-bottom: 20px;
        }
        .final-match-placeholder {
            /* Style pour le match final au centre si besoin */
            width: 220px; /* Largeur pour le match final */
        }
        

        .teams-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; } 
        .team-card { 
            background-color: var(--current-card-bg); 
            border: 1px solid var(--current-border-color); 
            transition: all 0.3s ease; 
        }
        .team-card:hover { transform: translateY(-5px) scale(1.03); border-color: var(--ucl-connector-blue); box-shadow: 0 8px 20px rgba(96, 165, 250, 0.2);}
        .team-card h4 { color: var(--ucl-text-primary); }

        footer { 
            background-color: transparent; /* Footer sur le fond g√©n√©ral */
            color: var(--ucl-text-secondary); 
            padding: 40px 0 20px; 
            border-top: 1px solid var(--ucl-border-color); 
            margin-top: 50px;
        }
        .footer-section h3 { color: var(--current-accent-gold); border-bottom: 1px solid var(--current-accent-gold); }
        .footer-section ul li a { color: var(--ucl-text-secondary); }
        .footer-section ul li a:hover { color: var(--current-accent-gold); }
        .copyright { border-top: 1px solid var(--ucl-border-color); color: var(--ucl-text-secondary); opacity: 0.7; }
        
        .message-area {
            background-color: var(--ucl-mid-purple); 
            border: 1px solid var(--ucl-light-accent);
        }

        /* Responsive pour le Bracket Visuel (simplification, le vrai responsive est complexe) */
        @media (max-width: 1200px) {
            .knockout-bracket-visual { padding: 15px 5px; }
            .bracket-column.rounds-8-4, .bracket-column.round-semi { min-width: 160px; }
            .team-slot { font-size: 0.8rem; padding: 6px 8px; }
            .team-slot img.team-logo { width: 18px; height: 18px; margin-right: 6px; }
        }
        @media (max-width: 992px) {
            nav ul { background-color: rgba(16, 8, 34, 0.95); }
            .knockout-bracket-visual {
                /* Sur mobile, on pourrait forcer les colonnes √† s'empiler, mais √ßa casse le bracket.
                   Le d√©filement horizontal est souvent pr√©f√©rable.
                   Ou afficher une version simplifi√©e (liste de matchs).
                   Pour l'instant, on garde le d√©filement. */
            }
            .bracket-centerpiece-visual .trophy-icon { font-size: 4rem; }
        }
        @media (max-width: 768px) {
            .page-title-bar h1 {font-size: 2rem;}
            .section-title { font-size: 1.6rem; }
            .fixture-match { /* Styles pour l'ancienne table, √† v√©rifier si encore utilis√©s */
                flex-direction: column; 
            }
        }

    </style>
</head>
<body>
    <header>
        <div class="container header-container">
            <a href="index.html" class="logo"> 
                <img src="https://ironworkout.github.io/paul.wallon.bts.sio/OIP.png" alt="Logo Championnat Peluches √âlite">
                <h1>Peluche √âlite</h1>
            </a>
            <nav>
                <ul>
                    <li><a href="index.html"><i class="fas fa-shield-alt"></i> Ligues Nat.</a></li>
                    <li><a href="champions.html" class="active-nav-link"><i class="fas fa-trophy"></i> LDC</a></li> 
                    <li><a href="index.html#actualites-section-container"><i class="fas fa-newspaper"></i> Actualit√©s</a></li>
                </ul>
            </nav>
            <div class="header-actions">
                 <div id="drive-status" style="display: none;"> 
                    <i class="fab fa-google-drive"></i> <span id="drive-status-text">D√©connect√©</span>
                 </div>
                <button id="signin-button" disabled><i class="fab fa-google"></i> Drive</button>
            </div>
            <div class="hamburger"><i class="fas fa-bars"></i></div>
        </div>
    </header>

    <div class="page-title-bar">
        <div class="container">
            <h1><i class="fas fa-trophy"></i> Ligue des Champions des Peluches <i class="fas fa-star"></i></h1>
        </div>
    </div>

    <div class="tab-content active" id="ldc-content">
        <div class="container ldc-theme">
             <div class="section action-buttons">
                <button class="league-music-btn" id="ldc-music-btn" data-league-audio="ldc" aria-label="Jouer/Mettre en pause l'hymne de la LDC">
                    <i class="fas fa-play"></i> Hymne LDC
                </button>
            </div>
             <div class="section action-buttons">
                 <div class="season-selector-container">
                     <label for="ldc-season-selector">Saison LDC :</label>
                     <select id="ldc-season-selector" data-league="ldc"></select>
                     <button class="delete-season-btn" id="delete-season-ldc-btn" title="Supprimer la saison LDC s√©lectionn√©e" disabled><i class="fas fa-trash-alt"></i></button>
                 </div>
                 <button class="nouvelle-saison-btn" id="nouvelle-saison-ldc-btn" disabled><i class="fas fa-plus-circle"></i> Nouvelle Saison LDC</button>
                 <button class="sauvegarde-json-btn" id="sauvegarde-ldc-btn" disabled><i class="fas fa-save"></i> Sauvegarder LDC</button>
            </div>

            <div class="section" id="ldc-teams-section">
                <div class="section-header"><h2 class="section-title">√âquipes Qualifi√©es</h2></div>
                <div class="section-content"><div class="teams-grid" id="ldc-teams-grid"></div></div>
            </div>

            <div class="section" id="ldc-fixtures-section">
                <div class="section-header"><h2 class="section-title">Phase √† √âlimination Directe</h2></div>
                <div class="knockout-bracket-visual" id="ldc-knockout-stages">
                    <!-- Le bracket visuel sera g√©n√©r√© ici par JavaScript -->
                </div>
            </div>
            
            <div class="section" id="ldc-winner-section" style="text-align: center; display:none;">
                 <h2 class="section-title">üèÜ CHAMPION LDC üèÜ</h2>
                 <div id="ldc-winner-display" style="font-size: 2.5rem; color: var(--current-accent-gold); margin-top: 20px;">
                 </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container footer-container">
            <div class="footer-section"><h3>Navigation</h3><ul><li><a href="index.html">Accueil Championnats</a></li><li><a href="champions.html">Ligue des Champions</a></li><li><a href="index.html#actualites-section-container">Actualit√©s</a></li></ul></div>
            <div class="footer-section"><h3>Contact</h3><ul><li><a href="mailto:contact@peluche-elite.com">Email</a></li><li><a href="#">FAQ</a></li></ul></div>
        </div>
        <div class="copyright">¬© 2025 Championnat Peluche √âlite. Tous droits r√©serv√©s.</div>
    </footer>

    <div id="message-area" class="message-area" role="status" aria-live="polite"></div>
    <audio id="ldc-audio-player" src="https://ironworkout.github.io/paul.wallon.bts.sio/ldc.mp3" loop preload="auto"></audio>

    <script>
        // ... (JavaScript initial reste identique: GOOGLE_CLIENT_ID, initialLdcData, etc.) ...
        const GOOGLE_CLIENT_ID = "731283926358-viam3ulpgna14flfdeb9m92l8s620hoi.apps.googleusercontent.com";
        const GOOGLE_DRIVE_SCOPES = 'https://www.googleapis.com/auth/drive.file';
        const LDC_DATA_FILENAME = 'peluches_ldc_data.json'; 
        const BASE_URL = "https://ironworkout.github.io/paul.wallon.bts.sio/";
        const GIS_CHECK_INTERVAL = 100; 
        const GIS_MAX_RETRIES = 50; 

        const initialLdcData = {
            teams: { 
                "PSG Peluches": { "logo": "psg.png" }, "Olympique Ours": { "logo": "oo.png" },
                "Valenciennes FC": { "logo": "vafc.png" }, "Toulours FC": { "logo": "tfc.png" },
                "Peluche FC": { "logo": "pfc.png"}, "AS Carrotes": {"logo": "ascl.png"},
                "AS Saint-Ettours": { "logo": "asset.png"}, "Patapouf FC": { "logo": "patapouf.png"} ,
                "DreamTeam Fluffies": { "logo": "pfc.png" }, "Galactic Teddies": { "logo": "oo.png"},
                "United Plushies": { "logo": "tfc.png" }, "Cotton Ballers FC": { "logo": "vafc.png"},
                "The Snuggle Squad": { "logo": "ascl.png" }, "Wooly Wanderers": { "logo": "asset.png"},
                "Fuzzy Strikers": { "logo": "patapouf.png" }, "Velvet Victory": { "logo": "psg.png"}
            },
            seasons: [], active_season_id: null, fileId: null, filename: LDC_DATA_FILENAME
        };
        
        let ldcDataStore = JSON.parse(JSON.stringify(initialLdcData));

        let googleAccessToken = null, tokenClient = null;
        let isSavingDriveData = false; 
        let messageArea = null;
        let messageTimeoutId = null;
        let gisCheckRetries = 0;
        let audioContext = null;
        let ldcAudioPlayer = null;

        function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } }
        
        function showMessage(msg, duration = 3000, isError = false) {
            if (!messageArea) messageArea = document.getElementById('message-area');
            if (!messageArea) return;
            messageArea.textContent = msg;
            messageArea.classList.add('visible');
            if(isError) messageArea.classList.add('error-message'); else messageArea.classList.remove('error-message');
            clearTimeout(messageTimeoutId);
            messageTimeoutId = setTimeout(() => { messageArea.classList.remove('visible'); }, duration);
        }

        function initAudioContext() {
            if (audioContext) return;
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) { console.warn("Web Audio API non support√©e.", e); }
        }

        async function gisInitInternal() {
            console.log("Tentative d'initialisation de Google Identity Services...");
            if (typeof google !== 'undefined' && google.accounts && google.accounts.oauth2) {
                console.log("GIS pr√™t. Initialisation du client token.");
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: GOOGLE_CLIENT_ID,
                    scope: GOOGLE_DRIVE_SCOPES,
                    callback: tokenCallback,
                    error_callback: handleTokenError
                });
                updateAuthUI(false); 
                document.getElementById('signin-button').disabled = false;
                document.getElementById('drive-status').style.display = 'inline-flex';
            } else {
                console.log("GIS non encore pr√™t. Nouvelle tentative...");
                gisCheckRetries++;
                if (gisCheckRetries < GIS_MAX_RETRIES) {
                    setTimeout(gisInitInternal, GIS_CHECK_INTERVAL);
                } else {
                    console.error("√âchec du chargement de Google Identity Services apr√®s plusieurs tentatives.");
                    showMessage("Erreur: Service Google indisponible.", 5000, true);
                    updateAuthUI(false);
                    const driveStatus = document.getElementById('drive-status');
                    if(driveStatus) {
                        driveStatus.innerHTML = '<i class="fab fa-google-drive"></i> <span id="drive-status-text">Erreur GIS</span>';
                        driveStatus.classList.add('error');
                    }
                }
            }
        }

        function checkAndInitGis() {
            if (window.google && window.google.accounts && window.google.accounts.id) {
                gisInitInternal();
            } else {
                const script = document.createElement('script');
                script.src = 'https://accounts.google.com/gsi/client';
                script.async = true;
                script.defer = true;
                script.onload = gisInitInternal;
                script.onerror = () => {
                    console.error("√âchec du chargement du script GSI.");
                    showMessage("Impossible de charger les services Google.", 5000, true);
                     const driveStatus = document.getElementById('drive-status');
                     if(driveStatus) {
                        driveStatus.style.display = 'inline-flex';
                        driveStatus.innerHTML = '<i class="fab fa-google-drive"></i> <span id="drive-status-text">√âchec chargement GIS</span>';
                        driveStatus.classList.add('error');
                     }
                };
                document.head.appendChild(script);
            }
        }
        
        function handleTokenError(error) {
            console.error('Erreur de token:', error);
            showMessage(`Erreur d'authentification Google: ${error.message || error.details || 'Erreur inconnue'}`, 5000, true);
            googleAccessToken = null;
            updateAuthUI(false);
        }

        async function tokenCallback(tokenResponse) {
            if (tokenResponse && tokenResponse.access_token) {
                console.log("Token re√ßu.");
                googleAccessToken = tokenResponse.access_token;
                localStorage.setItem('google_access_token_ldc', googleAccessToken);
                updateAuthUI(true);
                await loadLdcDataFromDrive();
                populateLdcUI(); 
                document.getElementById('nouvelle-saison-ldc-btn').disabled = false;
                document.getElementById('sauvegarde-ldc-btn').disabled = false;
                document.getElementById('delete-season-ldc-btn').disabled = !(ldcDataStore.seasons && ldcDataStore.seasons.length > 1);
            } else {
                console.error("R√©ponse de token invalide:", tokenResponse);
                let errorMsg = "Erreur d'authentification Google.";
                if (tokenResponse && tokenResponse.error) { errorMsg += ` (${tokenResponse.error})` }
                showMessage(errorMsg, 5000, true);
                googleAccessToken = null;
                updateAuthUI(false);
            }
        }

        function handleAuthClick() {
            if (googleAccessToken) { 
                if (google.accounts && google.accounts.oauth2 && google.accounts.oauth2.revoke) {
                    google.accounts.oauth2.revoke(googleAccessToken, () => {
                        console.log('Token r√©voqu√©.');
                    });
                }
                googleAccessToken = null;
                localStorage.removeItem('google_access_token_ldc');
                updateAuthUI(false);
                ldcDataStore = JSON.parse(JSON.stringify(initialLdcData)); 
                populateLdcUI();
                showMessage("D√©connect√© de Google Drive.", 3000);
                document.getElementById('nouvelle-saison-ldc-btn').disabled = true;
                document.getElementById('sauvegarde-ldc-btn').disabled = true;
                document.getElementById('delete-season-ldc-btn').disabled = true;
            } else { 
                if (tokenClient) {
                    tokenClient.requestAccessToken({ prompt: 'consent' });
                } else {
                    console.error("Client Token non initialis√©.");
                    showMessage("Erreur d'initialisation Google. Veuillez r√©essayer.", 4000, true);
                }
            }
        }
        
        function updateAuthUI(isLoggedIn) {
            const signinButton = document.getElementById('signin-button');
            const driveStatusText = document.getElementById('drive-status-text');
            const driveStatusDiv = document.getElementById('drive-status');

            if (!signinButton || !driveStatusText || !driveStatusDiv) return;

            if (isLoggedIn) {
                signinButton.innerHTML = '<i class="fab fa-google-drive"></i> D√©connexion Drive';
                driveStatusText.textContent = 'Connect√©';
                driveStatusDiv.className = 'drive-status-indicator success'; // Use specific classes for status
            } else {
                signinButton.innerHTML = '<i class="fab fa-google"></i> Connexion Drive';
                driveStatusText.textContent = 'D√©connect√©';
                driveStatusDiv.className = 'drive-status-indicator error'; 
            }
            signinButton.disabled = !tokenClient && !isLoggedIn; // Disable if client not ready AND not logged in
            
            document.getElementById('nouvelle-saison-ldc-btn').disabled = !isLoggedIn;
            document.getElementById('sauvegarde-ldc-btn').disabled = !isLoggedIn;
            document.getElementById('delete-season-ldc-btn').disabled = !isLoggedIn || !(ldcDataStore.seasons && ldcDataStore.seasons.length > 1);
        }

        async function findOrCreateFile(filename, defaultContentStr = "{}", mimeType = 'application/json') {
             if (!googleAccessToken) return null;
             const driveStatusText = document.getElementById('drive-status-text');
             const driveStatusDiv = document.getElementById('drive-status');
             if(driveStatusText) driveStatusText.textContent = "Recherche fichier...";
             if(driveStatusDiv) driveStatusDiv.className = 'drive-status-indicator loading';

            try {
                const responseSearch = await fetch(`https://www.googleapis.com/drive/v3/files?q=name='${filename}'&spaces=drive&fields=files(id,name)`, {
                    headers: { 'Authorization': `Bearer ${googleAccessToken}` }
                });
                if (!responseSearch.ok) throw new Error(`Recherche √©chou√©e: ${responseSearch.status} ${await responseSearch.text()}`);
                const searchResult = await responseSearch.json();

                if (searchResult.files && searchResult.files.length > 0) {
                    if(driveStatusText) driveStatusText.textContent = "Fichier trouv√©.";
                    if(driveStatusDiv) driveStatusDiv.className = 'drive-status-indicator success'; // back to connected state
                    return searchResult.files[0].id;
                } else {
                    if(driveStatusText) driveStatusText.textContent = "Cr√©ation fichier...";
                    const metadata = { name: filename, mimeType: mimeType };
                    const form = new FormData();
                    form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                    form.append('file', new Blob([defaultContentStr], { type: mimeType }));

                    const responseCreate = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id', {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${googleAccessToken}` },
                        body: form
                    });
                    if (!responseCreate.ok) throw new Error(`Cr√©ation √©chou√©e: ${responseCreate.status} ${await responseCreate.text()}`);
                    const createdFile = await responseCreate.json();
                    if(driveStatusText) driveStatusText.textContent = "Fichier cr√©√©.";
                     if(driveStatusDiv) driveStatusDiv.className = 'drive-status-indicator success';
                    return createdFile.id;
                }
            } catch (error) {
                console.error('Erreur Drive (findOrCreateFile):', error);
                showMessage(`Erreur Drive: ${error.message}`, 5000, true);
                if(driveStatusText) driveStatusText.textContent = "Erreur Fichier";
                if(driveStatusDiv) driveStatusDiv.className = 'drive-status-indicator error';
                return null;
            }
        }

        async function readFileContent(fileId) { /* ... (identique, mais s'assurer que les classes loading/error sont bien g√©r√©es) ... */ return "";}
        async function updateFileContent(fileId, content) { /* ... (identique, idem) ... */ return false;}
        
        // ... (loadLdcDataFromDrive, saveLdcDataToDrive, populateLdcSeasonSelector, populateLdcTeamsGridDOM, createNewLdcSeason, deleteSelectedLdcSeason, handleLdcSeasonChange restent similaires, mais populateLdcUI et handleLdcScoreChange sont impact√©s par le nouveau bracket)

        async function loadLdcDataFromDrive() {
            if (!googleAccessToken) {
                console.log("Non connect√©, utilisation des donn√©es LDC initiales.");
                ldcDataStore = JSON.parse(JSON.stringify(initialLdcData));
                return;
            }
             const driveStatusText = document.getElementById('drive-status-text');
             const driveStatusDiv = document.getElementById('drive-status');
             if(driveStatusText) driveStatusText.textContent = `Chargement ${LDC_DATA_FILENAME}...`;
             if(driveStatusDiv) driveStatusDiv.className = 'drive-status-indicator loading';

            ldcDataStore.fileId = await findOrCreateFile(LDC_DATA_FILENAME, JSON.stringify(initialLdcData));
            if (ldcDataStore.fileId) {
                const content = await readFileContent(ldcDataStore.fileId); // Cette fonction doit √™tre compl√©t√©e ou r√©utilis√©e
                if (content && content.trim() !== "") {
                    try {
                        const parsedData = JSON.parse(content);
                        if (parsedData && typeof parsedData.teams === 'object' && Array.isArray(parsedData.seasons)) {
                            ldcDataStore = parsedData;
                            ldcDataStore.fileId = ldcDataStore.fileId; // Ensure fileId from findOrCreateFile is kept
                            ldcDataStore.filename = LDC_DATA_FILENAME;
                            console.log(`Donn√©es LDC charg√©es depuis Drive.`);
                             if(driveStatusText) driveStatusText.textContent = 'Connect√©';
                             if(driveStatusDiv) driveStatusDiv.className = 'drive-status-indicator success';
                        } else { /* ... gestion erreur parsing ... */ }
                    } catch (e) { /* ... gestion erreur parsing ... */ }
                } else { /* ... gestion fichier vide ... */ }
            } else { /* ... gestion impossible de trouver/cr√©er fichier ... */ }
        }
        
        // La fonction `populateLdcFixturesDOM` doit √™tre compl√®tement r√©√©crite pour le nouveau bracket
        function populateLdcFixturesDOM(activeSeason) {
            const bracketContainer = document.getElementById('ldc-knockout-stages');
            if (!bracketContainer || !activeSeason || !activeSeason.phase_elimination) {
                if(bracketContainer) bracketContainer.innerHTML = '<p style="text-align:center; padding:20px;">Aucun match √† afficher.</p>';
                return;
            }
            bracketContainer.innerHTML = ''; // Nettoyer l'ancien contenu

            const teamsInfo = ldcDataStore.teams || {};
            const pe = activeSeason.phase_elimination;

            // D√©terminer le nombre max d'√©quipes pour savoir quel bracket afficher (16, 8, 4, 2)
            let numTeamsTournament = activeSeason.teams_in_tournament.length;
            
            const createTeamSlotHTML = (teamName, score, stageKey, matchIdx, teamType, match) => {
                const teamData = teamsInfo[teamName];
                const logo = teamData ? `<img src="${BASE_URL}${teamData.logo}" alt="${teamName}" class="team-logo">` : (teamName && teamName !== "√Ä d√©terminer" && teamName !== "BYE" ? '<span class="team-logo placeholder-logo">?</span>' : '');
                const scoreVal = score !== null ? score : '';
                // Le score input est maintenant √† l'int√©rieur du team-slot
                // Il faudrait un input par √©quipe ou un syst√®me centralis√© par match.
                // Pour l'instant, je vais juste afficher le nom et le logo, les scores doivent √™tre g√©r√©s diff√©remment avec ce design.
                // Temporairement, ajoutons un input discret
                let scoreInputHTML = '';
                if (teamName && teamName !== "√Ä d√©terminer" && teamName !== "BYE" && match.home !== "BYE" && match.away !== "BYE") {
                     scoreInputHTML = `<input type="number" class="score-input-bracket" value="${scoreVal}" min="0" data-stagekey="${stageKey}" data-matchidx="${matchIdx}" data-team="${teamType}">`;
                }
                
                let winnerClass = '';
                if(match.winner === teamName && teamName !== "BYE") winnerClass = 'winner';
                else if (match.winner && match.winner !== teamName && teamName !== "BYE") winnerClass = 'loser';


                return `<div class="team-slot ${winnerClass}" data-team-name="${teamName || ''}">
                            ${logo}
                            <span class="team-name">${teamName || '√Ä d√©terminer'}</span>
                            ${scoreInputHTML}
                        </div>`;
            };

            const createMatchItemHTML = (match, stageKey, matchIdxOffset = 0) => {
                const matchIndex = pe[stageKey].indexOf(match) + matchIdxOffset;
                 // Label du match (ex: R16-1, QF-1)
                const labelText = `${stageKey.substring(0,2).toUpperCase()}-${matchIndex + 1}`; // R16, QF, DE, FI
                let labelStyle = '';
                // Positionner le label - ceci est un exemple, un calcul plus pr√©cis est n√©cessaire
                if(stageKey === 'huitiemes' || stageKey === 'quarts') labelStyle = 'top: 50%; right: -25px; transform: translateY(-50%);';
                if(stageKey === 'demies') labelStyle = 'top: 50%; right: -30px; transform: translateY(-50%);';
                // Pour les c√¥t√©s gauches, ce serait left: -25px;
                
                // La structure du match avec les deux slots d'√©quipe
                return `<div class="bracket-match-item" data-match-id="${match.match_id}">
                            ${createTeamSlotHTML(match.home, match.scoreHome, stageKey, matchIndex, 'home', match)}
                            ${createTeamSlotHTML(match.away, match.scoreAway, stageKey, matchIndex, 'away', match)}
                            ${stageKey !== 'finale' ? `<div class="match-label" style="${labelStyle}">${labelText}</div>` : ''}
                        </div>`;
            };
            
            const createConnectorHTML = (type = 'vertical', height = '50px', positionStyle = '') => {
                 return `<div class="connector ${type}" style="height:${height}; ${positionStyle}"></div>`;
            }

            // G√©n√©rer les colonnes du bracket
            // Colonne 8√®mes Gauche (si applicable)
            if (numTeamsTournament >= 16 && pe.huitiemes && pe.huitiemes.length > 0) {
                const col8L = document.createElement('div');
                col8L.className = 'bracket-column rounds-8-4 column-r16-left';
                for (let i = 0; i < 4; i++) { // 4 matchs √† gauche
                    if (pe.huitiemes[i]) col8L.innerHTML += createMatchItemHTML(pe.huitiemes[i], 'huitiemes');
                }
                bracketContainer.appendChild(col8L);
            }
            // Colonne Quarts Gauche
            if (numTeamsTournament >= 8 && pe.quarts && pe.quarts.length > 0) {
                 const colQL = document.createElement('div');
                 colQL.className = 'bracket-column rounds-8-4 column-qf-left';
                 for (let i = 0; i < 2; i++) { // 2 matchs √† gauche
                    if (pe.quarts[i]) colQL.innerHTML += createMatchItemHTML(pe.quarts[i], 'quarts');
                 }
                 bracketContainer.appendChild(colQL);
            }
            // Colonne Demies Gauche
            if (numTeamsTournament >= 4 && pe.demies && pe.demies.length > 0) {
                 const colSL = document.createElement('div');
                 colSL.className = 'bracket-column round-semi column-sf-left';
                 if (pe.demies[0]) colSL.innerHTML += createMatchItemHTML(pe.demies[0], 'demies');
                 bracketContainer.appendChild(colSL);
            }

            // Centre (Troph√©e et Finale)
            const centerDiv = document.createElement('div');
            centerDiv.className = 'bracket-centerpiece-visual';
            centerDiv.innerHTML = '<i class="fas fa-trophy trophy-icon"></i>';
            if (numTeamsTournament >= 2 && pe.finale && pe.finale.length > 0) {
                const finalMatchDiv = document.createElement('div');
                finalMatchDiv.className = 'final-match-placeholder'; // Classe pour styler le match final
                finalMatchDiv.innerHTML = createMatchItemHTML(pe.finale[0], 'finale');
                centerDiv.appendChild(finalMatchDiv);
            }
            bracketContainer.appendChild(centerDiv);

            // Colonne Demies Droite
            if (numTeamsTournament >= 4 && pe.demies && pe.demies.length > 1) { // S'il y a un 2e match de demi
                 const colSR = document.createElement('div');
                 colSR.className = 'bracket-column round-semi column-sf-right';
                 if (pe.demies[1]) colSR.innerHTML += createMatchItemHTML(pe.demies[1], 'demies', 1); // offset de 1 pour matchIdx
                 bracketContainer.appendChild(colSR);
            }
             // Colonne Quarts Droite
            if (numTeamsTournament >= 8 && pe.quarts && pe.quarts.length > 2) {
                 const colQR = document.createElement('div');
                 colQR.className = 'bracket-column rounds-8-4 column-qf-right';
                 for (let i = 2; i < 4; i++) { 
                    if (pe.quarts[i]) colQR.innerHTML += createMatchItemHTML(pe.quarts[i], 'quarts', 2);
                 }
                 bracketContainer.appendChild(colQR);
            }
            // Colonne 8√®mes Droite
            if (numTeamsTournament >= 16 && pe.huitiemes && pe.huitiemes.length > 4) {
                const col8R = document.createElement('div');
                col8R.className = 'bracket-column rounds-8-4 column-r16-right';
                for (let i = 4; i < 8; i++) { 
                    if (pe.huitiemes[i]) col8R.innerHTML += createMatchItemHTML(pe.huitiemes[i], 'huitiemes', 4);
                }
                bracketContainer.appendChild(col8R);
            }
            
            // Ajouter des √©couteurs d'√©v√©nements pour les nouveaux inputs de score
            document.querySelectorAll('#ldc-knockout-stages .score-input-bracket').forEach(input => {
                input.addEventListener('change', handleLdcScoreChange);
            });

            // Logique pour dessiner les connecteurs (simplifi√©, n√©cessite une g√©om√©trie pr√©cise)
            // Cela devient tr√®s complexe √† faire dynamiquement en JS pour un rendu parfait.
            // Une approche plus robuste serait d'utiliser SVG ou une librairie de bracket.
            // Ici, une tentative tr√®s basique :
            const matchesItems = bracketContainer.querySelectorAll('.bracket-match-item');
            matchesItems.forEach((matchEl, index) => {
                // Pourrait ajouter des divs de connexion ici, mais leur positionnement CSS serait complexe
                // Exemple : si ce n'est pas la finale et qu'il y a un match suivant...
            });
        }


        function handleLdcScoreChange(event) {
            // ... (logique de mise √† jour du score dans ldcDataStore identique) ...
            const input = event.target; const stageKey = input.dataset.stagekey; const matchIndex = parseInt(input.dataset.matchidx);
            const teamType = input.dataset.team; let score = input.value === '' ? null : parseInt(input.value);
            const activeSeason = ldcDataStore.seasons.find(s => s.season_id === ldcDataStore.active_season_id);
            if (!activeSeason || !activeSeason.phase_elimination || !activeSeason.phase_elimination[stageKey] || !activeSeason.phase_elimination[stageKey][matchIndex]) return;
            const match = activeSeason.phase_elimination[stageKey][matchIndex];
            if (score !== null && (isNaN(score) || score < 0)) { input.value = match[teamType === 'home' ? 'scoreHome' : 'scoreAway'] || ''; return; }
            
            if (teamType === 'home') match.scoreHome = score; else match.scoreAway = score;
            
            if (match.home === "BYE") match.winner = match.away; 
            else if (match.away === "BYE") match.winner = match.home; 
            else if (typeof match.scoreHome === 'number' && typeof match.scoreAway === 'number') {
                if(match.scoreHome > match.scoreAway) match.winner = match.home;
                else if (match.scoreAway > match.scoreHome) match.winner = match.away;
                else match.winner = null; 
            } else match.winner = null;

            checkAndAdvanceLdcStage(activeSeason); // Cette fonction va maintenant repeupler avec populateLdcFixturesDOM
            displayLdcWinner(activeSeason); 
            if(googleAccessToken) saveLdcDataToDrive();
        }

        function checkAndAdvanceLdcStage(activeSeason) { /* ... (Logique identique mais √† la fin, elle appellera populateLdcFixturesDOM qui redessinera tout le bracket visuel) ... */ 
             if (!activeSeason || !activeSeason.phase_elimination) return;
            const pe = activeSeason.phase_elimination;
            const stagesOrder = ['huitiemes', 'quarts', 'demies', 'finale'];
            let currentStageFullyPlayed = false; 
            let nextStageToGenerateKey = null; 
            let winnersFromCurrentStage = [];

            for(let i = 0; i < stagesOrder.length; i++) {
                const stageKey = stagesOrder[i];
                const nextKey = stagesOrder[i+1];
                
                if(!pe[stageKey] || pe[stageKey].length === 0) {
                    let numMatchesForCurrentStage = 0;
                    let teamsForCurrentStage = [];

                    if (i === 0) { // Premi√®re √©tape du tournoi
                        teamsForCurrentStage = activeSeason.teams_in_tournament || [];
                        if (stageKey === 'huitiemes' && teamsForCurrentStage.length >=1 ) numMatchesForCurrentStage = Math.ceil(teamsForCurrentStage.length / 2); // 8 pour 16, 4 pour 8 etc.
                        else if (stageKey === 'quarts' && teamsForCurrentStage.length >=1) numMatchesForCurrentStage = Math.ceil(teamsForCurrentStage.length / 2);
                        else if (stageKey === 'demies' && teamsForCurrentStage.length >=1) numMatchesForCurrentStage = Math.ceil(teamsForCurrentStage.length / 2);
                        else if (stageKey === 'finale' && teamsForCurrentStage.length >=1) numMatchesForCurrentStage = Math.ceil(teamsForCurrentStage.length / 2);
                    } else { // √âtapes suivantes, bas√©es sur les vainqueurs pr√©c√©dents
                         const prevStageKey = stagesOrder[i-1];
                         if(pe[prevStageKey] && pe[prevStageKey].every(m => m.winner || m.home === "BYE" || m.away === "BYE")){
                             teamsForCurrentStage = pe[prevStageKey].map(m => m.winner).filter(Boolean);
                             numMatchesForCurrentStage = Math.ceil(teamsForCurrentStage.length / 2);
                         }
                    }
                    
                    if(numMatchesForCurrentStage > 0 && teamsForCurrentStage.length > 0){
                        console.log(`G√©n√©ration des matchs pour ${stageKey} car vide ou non initialis√©e.`);
                        pe[stageKey] = generateKnockoutStage(stageKey.charAt(0).toUpperCase() + stageKey.slice(1), numMatchesForCurrentStage, [], teamsForCurrentStage);
                        currentStageFullyPlayed = false; 
                        break; 
                    } else {
                         // On ne peut pas g√©n√©rer cette √©tape, on arr√™te.
                        break;
                    }
                }

                const allMatchesInStageHaveWinner = pe[stageKey].every(m => {
                    if (m.home === "BYE" && !m.winner) { m.winner = m.away; return true;}
                    if (m.away === "BYE" && !m.winner) { m.winner = m.home; return true;}
                    return m.winner;
                });

                if(allMatchesInStageHaveWinner) { 
                    currentStageFullyPlayed = true; 
                    winnersFromCurrentStage = pe[stageKey].map(m => m.winner).filter(Boolean); 
                    if(nextKey && (!pe[nextKey] || pe[nextKey].length === 0)) { 
                        nextStageToGenerateKey = nextKey; 
                        break; 
                    } else if (!nextKey && stageKey === 'finale') { 
                         activeSeason.vainqueur = winnersFromCurrentStage[0]; 
                    }
                } else { 
                    currentStageFullyPlayed = false; 
                    winnersFromCurrentStage = []; 
                    break; 
                }
            }
            
            if (nextStageToGenerateKey && winnersFromCurrentStage.length > 0) {
                const numNextMatches = Math.ceil(winnersFromCurrentStage.length / 2);
                if (numNextMatches > 0) {
                    console.log(`G√©n√©ration de ${nextStageToGenerateKey} avec ${winnersFromCurrentStage.length} vainqueurs.`);
                    pe[nextStageToGenerateKey] = generateKnockoutStage(
                        nextStageToGenerateKey.charAt(0).toUpperCase() + nextStageToGenerateKey.slice(1), 
                        numNextMatches, 
                        [], 
                        winnersFromCurrentStage
                    );
                }
            }
            populateLdcFixturesDOM(activeSeason); // Redessine toujours pour refl√©ter les vainqueurs/scores
        }
        
        function populateLdcUI() {
            populateLdcSeasonSelector();
            const activeSeason = ldcDataStore.seasons.find(s => s.season_id === ldcDataStore.active_season_id);
            populateLdcTeamsGridDOM(ldcDataStore.teams); 
            if (activeSeason) {
                // S'assurer que les phases sont initialis√©es si elles n'existent pas
                if (!activeSeason.phase_elimination) activeSeason.phase_elimination = { huitiemes: [], quarts: [], demies: [], finale: [] };
                ['huitiemes', 'quarts', 'demies', 'finale'].forEach(phase => {
                    if (!activeSeason.phase_elimination[phase]) activeSeason.phase_elimination[phase] = [];
                });
                // Appeler checkAndAdvance pour potentiellement g√©n√©rer la premi√®re phase si vide
                checkAndAdvanceLdcStage(activeSeason); // Ceci appellera populateLdcFixturesDOM
                displayLdcWinner(activeSeason);
            } else {
                document.getElementById('ldc-knockout-stages').innerHTML = '<p style="text-align:center; padding:20px; color: var(--current-text-light);">Aucune saison LDC active. Cr√©ez une nouvelle saison pour commencer.</p>';
                document.getElementById('ldc-winner-section').style.display = 'none';
            }
            const deleteBtn = document.getElementById(`delete-season-ldc-btn`);
            if(deleteBtn) deleteBtn.disabled = !googleAccessToken || !ldcDataStore.seasons || ldcDataStore.seasons.length <= 1;
            
            const saveBtn = document.getElementById('sauvegarde-ldc-btn');
            const newSeasonBtn = document.getElementById('nouvelle-saison-ldc-btn');
            if(saveBtn) saveBtn.disabled = !googleAccessToken;
            if(newSeasonBtn) newSeasonBtn.disabled = !googleAccessToken;
        }

        // ... (Reste du JavaScript : displayLdcWinner, observeActiveTabSections, hamburger, nav links, music, event listeners, DOMContentLoaded)
        // Les fonctions utilitaires (shuffleArray, showMessage, initAudioContext, etc.) restent les m√™mes.
        // Les fonctions Google Drive (gisInitInternal, checkAndInitGis, tokenCallback, handleAuthClick, findOrCreateFile, readFileContent, updateFileContent, loadLdcDataFromDrive, saveLdcDataToDrive) restent les m√™mes.
        // Les fonctions de gestion de saison (populateLdcSeasonSelector, populateLdcTeamsGridDOM, createNewLdcSeason, deleteSelectedLdcSeason, handleLdcSeasonChange) restent les m√™mes.

        function displayLdcWinner(activeSeason) { /* ... Identique ... */ }
        const allNavLinks = document.querySelectorAll('header nav ul li a');
        const observer = new IntersectionObserver((entries, obs) => { entries.forEach(entry => { if (entry.isIntersecting) { entry.target.style.opacity = '1'; entry.target.style.transform = 'translateY(0)'; obs.unobserve(entry.target); } }); }, { threshold: 0.05 }); 
        function observeActiveTabSections() { document.querySelectorAll('.section').forEach(el => { if (el.style.opacity !== '1') { el.style.opacity = '0'; el.style.transform = 'translateY(25px)'; } observer.observe(el) });}
        
        const hamburger = document.querySelector('.hamburger'); const nav = document.querySelector('header nav');
        if (hamburger && nav) { /* ... Identique ... */ }
        allNavLinks.forEach(link => { /* ... Identique ... */ });
        
        const ldcMusicBtn = document.getElementById('ldc-music-btn');
        if (ldcMusicBtn) {  /* ... Identique ... */ }
        
        document.getElementById('nouvelle-saison-ldc-btn')?.addEventListener('click', createNewLdcSeason);
        document.getElementById('sauvegarde-ldc-btn')?.addEventListener('click', () => saveLdcDataToDrive());
        document.getElementById('delete-season-ldc-btn')?.addEventListener('click', deleteSelectedLdcSeason);
        document.getElementById('ldc-season-selector')?.addEventListener('change', handleLdcSeasonChange);
        document.getElementById('signin-button')?.addEventListener('click', handleAuthClick);

        document.addEventListener('DOMContentLoaded', async () => { /* ... Identique pour l'initialisation et la gestion du token ... */ 
            messageArea = document.getElementById('message-area');
            ldcAudioPlayer = document.getElementById('ldc-audio-player'); 
            const storedToken = localStorage.getItem('google_access_token_ldc');
            if (storedToken) googleAccessToken = storedToken;
            
            await checkAndInitGis(); 

            if(googleAccessToken){ 
                updateAuthUI(true); 
                await loadLdcDataFromDrive(); 
            } else {
                updateAuthUI(false); 
                ldcDataStore = JSON.parse(JSON.stringify(initialLdcData));
            }
            
            populateLdcUI(); 
            observeActiveTabSections();
            
            const activeNavLink = document.querySelector('header nav ul li a[href="champions.html"]');
            if(activeNavLink) activeNavLink.classList.add('active-nav-link');

            console.log("Page LDC initialis√©e avec style visuel Bracket.");
        });

    </script>
</body>
</html>
